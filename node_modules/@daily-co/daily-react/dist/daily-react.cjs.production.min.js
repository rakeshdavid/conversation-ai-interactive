"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("react"),t=e(n),r=require("recoil"),i=e(require("lodash.throttle")),a=e(require("@daily-co/daily-js")),o=e(require("fast-deep-equal"));function u(e,n,t,r,i,a,o){try{var u=e[a](o),l=u.value}catch(e){return void t(e)}u.done?n(l):Promise.resolve(l).then(r,i)}function l(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){u(a,r,i,o,l,"next",e)}function l(e){u(a,r,i,o,l,"throw",e)}o(void 0)}))}}function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function s(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n.indexOf(t=a[r])>=0||(i[t]=e[t]);return i}function d(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function f(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return d(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?d(e,void 0):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p=n.createContext(null),v=function(){var e=n.useContext(p);return n.useDebugValue(e),e},g=n.createContext({on:function(){},off:function(){}}),y=-1,m=function(){return y--},b=1,k=function(){return b++},h=function(e,t,r){void 0===r&&(r=!1);var i=n.useContext(g),a=i.off,o=i.on,u=n.useState(!1),l=u[0],c=u[1],s=n.useRef(0),d=n.useMemo((function(){return r?m():k()}),[r]);n.useEffect((function(){if(e&&!l){if(s.current>1e5)return console.error("useDailyEvent called with potentially non-memoized event callback or due to too many re-renders.\n        Memoize using useCallback to avoid re-render loop or reduce the amount of state transitions the callback depends on.\n        Passed callback for '"+e+"' event is NOT registered.",t),void c(!0);s.current++;var n=setTimeout((function(){s.current=0}),50);return o(e,t,d),function(){clearTimeout(n),a(e,d)}}}),[t,e,d,l,a,o]),n.useDebugValue({event:e,eventId:d,isBlocked:l,callback:t})},S=r.atomFamily({key:"daily-react-participant-property-paths",default:[]}),C=r.atomFamily({key:"daily-react-participant-property",default:null,dangerouslyAllowMutability:!0}),R=r.selectorFamily({key:"daily-react-participant-properties",get:function(e){var n=e.id,t=e.properties;return function(e){var r=e.get;return t.map((function(e){return r(C({id:n,property:e}))}))}},dangerouslyAllowMutability:!0}),A=function(e,t){var i,a=r.useRecoilValue(Array.isArray(t)?R({id:e,properties:t}):C({id:e,property:t}));return n.useDebugValue(Array.isArray(t)?t.reduce((function(e,n,t){return e[n]=a[t],e}),{}):((i={})[t]=a,i)),a},E=function(e,t,r,a){void 0===r&&(r=500),void 0===a&&(a=!1);var o=n.useContext(g),u=o.off,l=o.on,c=n.useMemo((function(){var n;return Array.isArray(e)?e.reduce((function(e,n){return e[n]=a?m():k(),e}),{}):((n={})[e]=a?m():k(),n)}),[e,a]),s=n.useRef([]);h("call-instance-destroyed",n.useCallback((function(){s.current.length=0}),[]));var d=n.useMemo((function(){return i((function(){0!==s.current.length&&(t(s.current),s.current.length=0)}),r,{trailing:!0})}),[t,r]);n.useEffect((function(){if(e){var n=function(e){s.current.push(e),d()};return Array.isArray(e)?e.forEach((function(e){return l(e,n,c[e])})):l(e,n,c[e]),function(){Array.isArray(e)?e.forEach((function(e){return u(e,c[e])})):u(e,c[e])}}}),[d,e,c,u,l]),n.useDebugValue({event:e,eventId:c})};function D(e,n){if(e===n)return!0;if(e instanceof MediaStream&&n instanceof MediaStream)return e.id===n.id&&e.active===n.active&&e.getTracks().length===n.getTracks().length&&e.getTracks().every((function(e,t){return D(e,n.getTracks()[t])}));if(e instanceof MediaStreamTrack&&n instanceof MediaStreamTrack)return e.id===n.id&&e.kind===n.kind&&e.readyState===n.readyState;if(e instanceof Date&&n instanceof Date)return e.getTime()===n.getTime();if(e instanceof RegExp&&n instanceof RegExp)return e.source===n.source&&e.flags===n.flags;if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(var t,r=f(e.values());!(t=r()).done;)if(!n.has(t.value))return!1;return!0}if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(var i,a=f(e.entries());!(i=a()).done;){var o=i.value,u=o[0],l=o[1];if(!n.has(u))return!1;if(!D(l,n.get(u)))return!1}return!0}if("object"!=typeof e||null===e||"object"!=typeof n||null===n)return!1;var c=Object.keys(e),s=Object.keys(n);if(c.length!==s.length)return!1;for(var d=0,p=c;d<p.length;d++){var v=p[d];if(!(v in n)||!D(e[v],n[v]))return!1}return!0}function w(e){var n,t=r.selector({key:e.key+"_inner",get:e.get});return r.selector({key:e.key,get:function(r){var i=(0,r.get)(t);return null!=n&&e.equals(i,n)?n:(n=i,i)}})}function x(e){var n=r.selectorFamily({key:e.key+"_inner",get:e.get}),t=new Map;return r.selectorFamily(c({},e,{key:e.key,get:function(r){return function(i){var a=(0,i.get)(n(r)),o=t.get(r);return null!=o&&e.equals(a,o)?o:(t.set(r,a),a)}}}))}var L=function(e){return function e(n,t,r){if(void 0===t&&(t=""),void 0===r&&(r=new Set),"object"!=typeof n||null===n||r.has(n))return[t];r.add(n);var i=[];for(var a in n)if(Object.prototype.hasOwnProperty.call(n,a)){var o=t?t+"."+a:a;i.push.apply(i,[o].concat(e(n[a],o,r)))}return r.delete(n),i}(e)},_=function(e,n){return n.map((function(n){return function(e,n){return String(n).split(".").filter((function(e){return e.length})).reduce((function(e,n){return e&&e[n]}),e)}(e,n)}))},V=r.atom({key:"daily-react-active-id",default:null}),I=r.atom({key:"daily-react-local-id",default:""}),T=r.atom({key:"daily-react-local-joined-date",default:null}),P=r.atom({key:"daily-react-participant-ids",default:[]}),j=r.atomFamily({key:"daily-react-participant-state",default:null,dangerouslyAllowMutability:!0}),M=r.atom({key:"daily-react-waiting-participants",default:[]}),O=r.atomFamily({key:"daily-react-waiting-participant",default:{awaitingAccess:{level:"full"},id:"",name:""}}),F=w({key:"daily-react-waitingParticipantsSelector",equals:D,get:function(e){var n=e.get;return n(M).map((function(e){return n(O(e))}))}}),B=function(e){var i=e.children,a=v(),o=n.useState(!1),u=o[0],s=o[1],d=r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(e){n((function(n){var t=n.set;t(I,e.local.session_id);var r=Object.values(e),i=r.map((function(e){return e.session_id}));t(P,i),r.forEach((function(e){t(j(e.session_id),e);var n=L(e);t(S(e.session_id),n),n.forEach((function(n){var r=_(e,[n])[0];t(C({id:e.session_id,property:n}),r)}))})),s(!0)}))}}),[]);n.useEffect((function(){if(a&&!u){var e=setInterval((function(){var n=a.participants();"local"in n&&(d(n),clearInterval(e))}),100);return function(){clearInterval(e)}}}),[a,u,d]);var f=n.useCallback((function(){if(a){var e=null==a?void 0:a.participants();e.local&&d(e)}}),[a,d]);h("started-camera",f,!0),h("access-state-updated",f,!0),h("joining-meeting",r.useRecoilCallback((function(e){var n=e.set;return function(){n(T,new Date),f()}}),[f]),!0),h("joined-meeting",n.useCallback((function(e){d(e.participants)}),[d]),!0);var p=r.useRecoilCallback((function(e){var n=e.reset,t=e.snapshot;return l((function*(){n(I),n(V);var e=yield t.getPromise(P);Array.isArray(e)&&e.forEach((function(e){return n(j(e))})),n(P)}))}),[]);return h("call-instance-destroyed",p,!0),h("left-meeting",p,!0),E(["active-speaker-change","participant-joined","participant-updated","participant-left"],r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(e){e.length&&n((function(n){var t=n.get,r=n.reset,i=n.set;e.forEach((function(e){switch(e.action){case"active-speaker-change":i(V,e.activeSpeaker.peerId),i(j(e.activeSpeaker.peerId),(function(e){return e?c({},e,{last_active:new Date}):null}));break;case"participant-joined":i(P,(function(n){return n.includes(e.participant.session_id)?n:[].concat(n,[e.participant.session_id])})),i(j(e.participant.session_id),e.participant);var n=L(e.participant);i(S(e.participant.session_id),n),n.forEach((function(n){var t=_(e.participant,[n])[0];i(C({id:e.participant.session_id,property:n}),t)}));break;case"participant-updated":i(j(e.participant.session_id),(function(n){return c({},n,e.participant)})),e.participant.local&&i(I,(function(n){return n!==e.participant.session_id?e.participant.session_id:n}));var a=L(e.participant),o=t(S(e.participant.session_id));i(S(e.participant.session_id),(function(e){return D(e,a)?e:a})),o.filter((function(e){return!a.includes(e)})).forEach((function(n){r(C({id:e.participant.session_id,property:n}))})),a.forEach((function(n){var t=_(e.participant,[n])[0];i(C({id:e.participant.session_id,property:n}),(function(e){return D(e,t)?e:t}))}));break;case"participant-left":i(P,(function(n){return n.includes(e.participant.session_id)?[].concat(n.filter((function(n){return n!==e.participant.session_id}))):n})),r(j(e.participant.session_id)),t(S(e.participant.session_id)).forEach((function(n){r(C({id:e.participant.session_id,property:n}))})),r(S(e.participant.session_id))}}))}))}}),[]),100,!0),E(["waiting-participant-added","waiting-participant-updated","waiting-participant-removed"],r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(e){n((function(n){var t=n.reset,r=n.set;e.forEach((function(e){switch(e.action){case"waiting-participant-added":r(M,(function(n){return n.includes(e.participant.id)?n:[].concat(n,[e.participant.id])})),r(O(e.participant.id),e.participant);break;case"waiting-participant-updated":r(O(e.participant.id),e.participant);break;case"waiting-participant-removed":r(M,(function(n){return n.filter((function(n){return n!==e.participant.id}))})),t(O(e.participant.id))}}))}))}}),[]),100,!0),t.createElement(t.Fragment,null,i)},q=function(){var e=r.useRecoilValue(I);return n.useDebugValue(e),e},U=function(){return!0},N=function(e){var t=void 0===e?{}:e,i=t.filter,a=void 0===i?U:i,o=t.ignoreLocal,u=void 0!==o&&o,l=q(),c=r.useRecoilValue(V),s=u&&c===l,d=!(null!=a&&a(c)),f=n.useState(s||d?null:c),p=f[0],v=f[1];return n.useEffect((function(){s||d||v(c)}),[d,s,c]),n.useDebugValue(p),p},W=function(e){return["blocked","off"].includes(e)},z=x({key:"daily-react-participant-ids-filtered-sorted",equals:D,get:function(e){var n=e.filter,t=e.sort;return function(e){var r=e.get;return r(P).filter((function(e){switch(n){case"local":case"owner":case"record":return r(C({id:e,property:n}));case"remote":return!r(C({id:e,property:"local"}));case"screen":var t=r(R({id:e,properties:["tracks.screenAudio.state","tracks.screenVideo.state"]})),i=t[1];return!W(t[0])||!W(i);default:return!0}})).sort((function(e,n){switch(t){case"joined_at":case"session_id":case"user_id":case"user_name":var i=r(R({id:e,properties:[t]}))[0],a=r(R({id:n,properties:[t]}))[0];if(void 0!==i||void 0!==a){if(void 0===i)return-1;if(void 0===a)return 1;if(i>a)return 1;if(i<a)return-1}return 0;default:return 0}}))}}}),G=function(e){var t=void 0===e?{}:e,i=t.filter,a=t.onActiveSpeakerChange,o=t.onParticipantJoined,u=t.onParticipantLeft,l=t.onParticipantUpdated,c=t.sort,s=r.useRecoilValue(z({filter:"string"==typeof i?i:null,sort:"string"==typeof c?c:null})),d="function"==typeof i||"function"==typeof c,f=n.useCallback((function(e){return"function"!=typeof i&&"function"!=typeof c?[]:s.map((function(n){return e.getLoadable(j(n)).contents})).filter(Boolean).filter("function"==typeof i?i:function(){return!0}).sort("function"==typeof c?c:function(){return 0}).map((function(e){return e.session_id})).filter(Boolean)}),[i,s,c]),p=n.useState([]),v=p[0],g=p[1],y=r.useRecoilCallback((function(e){var n=e.snapshot;return function(){if(d){var e=f(n);D(e,v)||g(e)}}}),[v,f,d]);n.useEffect((function(){y()}),[y]),E(["participant-joined","participant-updated","active-speaker-change","participant-left"],n.useCallback((function(e){e.length&&(e.forEach((function(e){switch(e.action){case"participant-joined":null==o||o(e);break;case"participant-updated":null==l||l(e);break;case"active-speaker-change":null==a||a(e);break;case"participant-left":null==u||u(e)}})),y())}),[y,a,o,u,l]));var m="function"==typeof i||"function"==typeof c?v:s;return n.useDebugValue(m),m},H=w({key:"daily-react-screen-shares",equals:D,get:function(e){var n=e.get;return n(z({filter:"screen",sort:null})).map((function(e){return{local:n(C({id:e,property:"local"})),screenAudio:n(C({id:e,property:"tracks.screenAudio"})),screenVideo:n(C({id:e,property:"tracks.screenVideo"})),screenId:e+"-screen",session_id:e}}))}}),Q=function(e){var t=void 0===e?{}:e,i=t.onError,a=t.onLocalScreenShareStarted,o=t.onLocalScreenShareStopped,u=v(),l=n.useCallback((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];null==u||u.startScreenShare.apply(u,n)}),[u]),c=n.useCallback((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];null==u||u.stopScreenShare.apply(u,n)}),[u]);h("local-screen-share-started",n.useCallback((function(){return null==a?void 0:a()}),[a])),h("local-screen-share-stopped",n.useCallback((function(){return null==o?void 0:o()}),[o])),h("nonfatal-error",n.useCallback((function(e){"screen-share-error"===e.type&&(null==i||i(e))}),[i]));var s=r.useRecoilValue(H),d={isSharingScreen:s.some((function(e){return e.local})),screens:s,startScreenShare:l,stopScreenShare:c};return n.useDebugValue(d),d},J=function(e,t){void 0===t&&(t="video");var r=A(e,"tracks."+t),i=r?c({},r,{isOff:W(r.state)}):{isOff:!0,persistentTrack:void 0,state:"off",subscribed:!1};return n.useDebugValue(i),i};function $(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.useCallback((function(e){for(var n=0;n<t.length;n++){var r=t[n];"function"==typeof r?r(e):r&&"object"==typeof r&&(r.current=e)}}),t)}var K=["onPlayFailed","sessionId","type"],X=n.memo(n.forwardRef((function(e,r){var i=e.onPlayFailed,a=e.sessionId,o=e.type,u=void 0===o?"audio":o,l=s(e,K),c=n.useRef(null),d=J(a,u),f=$(c,r),p=null==d?void 0:d.subscribed;return n.useEffect((function(){var e=c.current;if(e&&null!=d&&d.persistentTrack){var n=function(){e.play().catch((function(n){null==i||i({sessionId:a,target:e,type:u,message:n.message,name:n.name})}))},t=function(){clearTimeout(void 0)};return e.addEventListener("canplay",n),e.addEventListener("play",t),e.srcObject=new MediaStream([null==d?void 0:d.persistentTrack]),function(){null==e||e.removeEventListener("canplay",n),null==e||e.removeEventListener("play",t)}}}),[null==d?void 0:d.persistentTrack,i,a,u]),t.createElement("audio",Object.assign({autoPlay:!0,ref:f},l,{"data-session-id":a,"data-audio-type":u,"data-subscribed":p}))})));X.displayName="DailyAudioTrack";var Y=n.memo(n.forwardRef((function(e,i){var a=e.autoSubscribeActiveSpeaker,o=void 0!==a&&a,u=e.maxSpeakers,c=void 0===u?5:u,s=e.onPlayFailed,d=e.playLocalScreenAudio,f=void 0!==d&&d,p=v(),g=n.useState(new Array(c).fill("")),y=g[0],m=g[1],b=Q().screens,k=q(),h=N({ignoreLocal:!0}),S=n.useRef(null);n.useImperativeHandle(i,(function(){return{getActiveSpeakerAudio:function(){var e,n;return null!=(e=null==(n=S.current)?void 0:n.querySelector('audio[data-session-id="'+h+'"][data-audio-type="audio"]'))?e:null},getAllAudio:function(){var e,n;return Array.from(null!=(e=null==(n=S.current)?void 0:n.querySelectorAll("audio"))?e:[])},getAudioBySessionId:function(e){var n,t;return null!=(n=null==(t=S.current)?void 0:t.querySelector('audio[data-session-id="'+e+'"][data-audio-type="audio"]'))?n:null},getRmpAudio:function(){var e,n;return Array.from(null!=(e=null==(n=S.current)?void 0:n.querySelectorAll('audio[data-audio-type="rmpAudio"]'))?e:[])},getScreenAudio:function(){var e,n;return Array.from(null!=(e=null==(n=S.current)?void 0:n.querySelectorAll('audio[data-audio-type="screenAudio"]'))?e:[])},getRmpAudioBySessionId:function(e){var n,t;return null!=(n=null==(t=S.current)?void 0:t.querySelector('audio[data-session-id="'+e+'"][data-audio-type="rmpAudio"]'))?n:null},getScreenAudioBySessionId:function(e){var n,t;return null!=(n=null==(t=S.current)?void 0:t.querySelector('audio[data-session-id="'+e+'"][data-audio-type="screenAudio"]'))?n:null}}}),[h]);var R=r.useRecoilCallback((function(e){var n=e.snapshot;return function(){var e=l((function*(e){var t,r=Object.values(null!=(t=null==p?void 0:p.participants())?t:{}).filter((function(e){return!e.local&&Boolean(e.tracks.audio.subscribed)})),i=function(e){return r.some((function(n){return n.session_id===e}))};if(!i(e)){if(!p||p.isDestroyed()||!o||p.subscribeToTracksAutomatically())return;p.updateParticipant(e,{setSubscribedTracks:{audio:!0}})}m((function(t){var a;if(t.includes(e))return t;var o=function(e){return!e||!i(e)};if(t.some(o)){var u=t.findIndex(o);return t[u]=e,[].concat(t)}var l=t.findIndex((function(e){return r.some((function(n){return n.session_id===e&&W(n.tracks.audio.state)}))}));if(l>=0)return t[l]=e,[].concat(t);var c=r.filter((function(e){return t.includes(e.session_id)&&e.session_id!==h})).sort((function(e,t){var r,i,a=null!=(r=n.getLoadable(C({id:e.session_id,property:"last_active"})).contents)?r:new Date("1970-01-01"),o=null!=(i=n.getLoadable(C({id:t.session_id,property:"last_active"})).contents)?i:new Date("1970-01-01");return a>o?1:a<o?-1:0}));if(!c.length){var s=t.findIndex((function(e){return e!==h}));return t[s]=e,[].concat(t)}var d=t.indexOf(null==(a=c[0])?void 0:a.session_id);return t[d]=e,[].concat(t)}))}));return function(n){return e.apply(this,arguments)}}()}),[h,o,p]),A=n.useCallback((function(e){m((function(n){if(!n.includes(e))return n;var t=[].concat(n),r=t.indexOf(e);return t[r]="",t}))}),[]);E(["active-speaker-change","track-started","participant-left"],n.useCallback((function(e){e.forEach((function(e){switch(e.action){case"active-speaker-change":if(e.activeSpeaker.peerId===k)return;R(e.activeSpeaker.peerId);break;case"track-started":"audio"===e.track.kind&&e.participant&&!e.participant.local&&R(e.participant.session_id);break;case"participant-left":A(e.participant.session_id)}}))}),[R,k,A]),200);var D=G({filter:n.useCallback((function(e){var n;return Boolean(null==e||null==(n=e.tracks)?void 0:n.rmpAudio)}),[])});return t.createElement("div",{ref:S},y.map((function(e,n){return t.createElement(X,{key:"speaker-slot-"+n,onPlayFailed:s,sessionId:e,type:"audio"})})),b.filter((function(e){return!!f||!e.local})).map((function(e){return t.createElement(X,{key:e.screenId,onPlayFailed:s,sessionId:e.session_id,type:"screenAudio"})})),D.map((function(e){return t.createElement(X,{key:e+"-rmp",onPlayFailed:s,sessionId:e,type:"rmpAudio"})})))})));Y.displayName="DailyAudio";var Z=["automirror","fit","mirror","onResize","playableStyle","sessionId","style","type"],ee=n.forwardRef((function(e,r){var i=e.automirror,a=e.fit,o=void 0===a?"contain":a,u=e.mirror,l=e.onResize,d=e.playableStyle,f=void 0===d?{}:d,p=e.sessionId,v=e.style,g=void 0===v?{}:v,y=e.type,m=void 0===y?"video":y,b=s(e,Z),k=q()===p,h="screenVideo"===m,S=k&&!h,C=n.useRef(null),R=$(C,r),E=J(p,m),D=E.persistentTrack,w=S||h||!E.isOff,x=A(p,"tracks."+m),L=null==x?void 0:x.subscribed,_=n.useMemo((function(){if("boolean"==typeof u)return u;if(!i)return!1;if(!D)return S;var e=D.getSettings();return"facingMode"in e?S&&"user"===e.facingMode:S}),[i,S,u,D]);return n.useEffect((function(){var e=C.current;if(e){var n=function(){var n=e.play();void 0!==n&&n.then((function(){e.controls=!1})).catch((function(n){e.controls=!0,console.warn("Failed to play video",n)}))},t=function(){e.paused&&n()},r=function(){e.style.transform="scale(1)"},i=function(){e.style.transform="",setTimeout((function(){e.paused&&n()}),100)},a=function(){"hidden"!==document.visibilityState&&e.paused&&n()};return e.addEventListener("canplay",t),e.addEventListener("enterpictureinpicture",r),e.addEventListener("leavepictureinpicture",i),document.addEventListener("visibilitychange",a),function(){e.removeEventListener("canplay",t),e.removeEventListener("enterpictureinpicture",r),e.removeEventListener("leavepictureinpicture",i),document.removeEventListener("visibilitychange",a)}}}),[]),n.useEffect((function(){var e=C.current;if(e&&D)return e.srcObject=new MediaStream([D]),e.load(),function(){e.srcObject=null,e.load()}}),[D,null==D?void 0:D.id]),n.useEffect((function(){var e,n=C.current;if(l&&n)return t(),n.addEventListener("loadedmetadata",t),n.addEventListener("resize",t),function(){e&&cancelAnimationFrame(e),n.removeEventListener("loadedmetadata",t),n.removeEventListener("resize",t)};function t(){e&&cancelAnimationFrame(e),e=requestAnimationFrame((function(){var e=C.current;if(e&&!document.hidden){var n=e.videoWidth,t=e.videoHeight;n&&t&&(null==l||l({aspectRatio:n/t,height:t,width:n}))}}))}}),[l]),t.createElement("video",Object.assign({autoPlay:!0,muted:!0,playsInline:!0,ref:R,"data-local":k,"data-mirrored":_||void 0,"data-playable":w||void 0,"data-session-id":p,"data-subscribed":L,"data-video-type":m,style:c({objectFit:o,transform:_?"scale(-1, 1)":""},g,w?f:{})},b))}));ee.displayName="DailyVideo";var ne=n.createContext({refreshDevices:function(){return Promise.resolve()}}),te=r.atom({key:"daily-react-general-camera-state",default:"idle"}),re=r.atom({key:"daily-react-general-microphone-state",default:"idle"}),ie=r.atom({key:"daily-react-camera-devices",default:[]}),ae=r.atom({key:"daily-react-microphone-devices",default:[]}),oe=r.atom({key:"daily-react-speaker-devices",default:[]}),ue=r.atom({key:"daily-react-last-camera-error",default:null}),le=function(e){var i=e.children,a=v(),o=r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return l((function*(){var e,t,r,i;if(void 0!==(null==(e=navigator)||null==(t=e.mediaDevices)?void 0:t.getUserMedia)&&void 0!==(null==(r=navigator)||null==(i=r.mediaDevices)?void 0:i.enumerateDevices)){if(a)try{var o=(yield a.enumerateDevices()).devices,u=o.filter((function(e){return"videoinput"===e.kind&&""!==e.deviceId})),l=o.filter((function(e){return"audioinput"===e.kind&&""!==e.deviceId})),c=o.filter((function(e){return"audiooutput"===e.kind&&""!==e.deviceId})),s=yield a.getInputDevices(),d=s.camera,f=s.mic,p=s.speaker,v=function(e,n,t){var r,i;return{device:n,selected:"deviceId"in e&&n.deviceId===e.deviceId,state:null!=(r=null==(i=t.find((function(e){return e.device.deviceId===n.deviceId})))?void 0:i.state)?r:"granted"}},g=function(e,n){return"default"===e.device.deviceId?-1:"default"===n.device.deviceId?1:e.device.label<n.device.label?-1:e.device.label>n.device.label?1:0};n((function(e){var n=e.set;n(ie,(function(e){return u.filter(Boolean).map((function(n){return v(d,n,e)})).sort(g)})),n(ae,(function(e){return l.filter(Boolean).map((function(n){return v(f,n,e)})).sort(g)})),n(oe,(function(e){return c.filter(Boolean).map((function(n){return v(p,n,e)})).sort(g)}))}))}catch(e){n((function(e){var n=e.set;n(te,"not-supported"),n(re,"not-supported")}))}}else n((function(e){var n=e.set;n(te,"not-supported"),n(re,"not-supported")}))}))}),[a]),u=r.useRecoilCallback((function(e){var n=e.set,t=e.snapshot,r=e.transact_UNSTABLE;return l((function*(){var e,i,u,l,s,d,f,p,v,g,y,m,b,k;if(a){var h=yield t.getPromise(te),S=yield t.getPromise(re),C=a.participants();if(C.local){var R=C.local.tracks,A="prompt",E="prompt";if(navigator.permissions)try{A=(yield navigator.permissions.query({name:"camera"})).state,E=(yield navigator.permissions.query({name:"microphone"})).state}catch(e){}var D="prompt"===A&&["idle","pending"].includes(h)&&"interrupted"===R.video.state&&!R.video.persistentTrack,w=["idle","pending"].includes(h)&&!R.video.persistentTrack&&Boolean(null==(e=R.video.off)?void 0:e.byUser),x="prompt"===E&&["idle","pending"].includes(S)&&"interrupted"===R.audio.state&&!R.audio.persistentTrack,L=["idle","pending"].includes(S)&&!R.audio.persistentTrack&&Boolean(null==(i=R.audio.off)?void 0:i.byUser);null!=(u=R.audio)&&null!=(l=u.blocked)&&l.byDeviceInUse?r((function(e){var n=e.set;n(re,"in-use"),n(ae,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"in-use"}):e}))}))})):null!=(s=R.audio)&&null!=(d=s.blocked)&&d.byDeviceMissing?n(re,"not-found"):null!=(f=R.audio)&&null!=(p=f.blocked)&&p.byPermissions||"denied"===E?n(re,"blocked"):x?n(re,"pending"):L?n(re,"idle"):r((function(e){var n=e.set;n(re,"granted"),n(ae,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"granted"}):e}))}))})),null!=(v=R.video)&&null!=(g=v.blocked)&&g.byDeviceInUse?r((function(e){var n=e.set;n(te,"in-use"),n(ie,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"in-use"}):e}))}))})):null!=(y=R.video)&&null!=(m=y.blocked)&&m.byDeviceMissing?n(te,"not-found"):null!=(b=R.video)&&null!=(k=b.blocked)&&k.byPermissions||"denied"===A?n(te,"blocked"):D?n(te,"pending"):w?n(te,"idle"):r((function(e){var n=e.set;n(te,"granted"),n(ie,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"granted"}):e}))}))})),o()}}}))}),[a,o]);return h("participant-updated",n.useCallback((function(e){e.participant.local&&u()}),[u])),h("available-devices-updated",o),h("selected-devices-updated",o),h("camera-error",r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(e){n((function(n){var t,r,i,a,o,u,l,c=n.set;switch(c(ue,e.error),null==(t=e.error)?void 0:t.type){case"cam-in-use":c(te,"in-use");break;case"mic-in-use":c(re,"in-use");break;case"cam-mic-in-use":c(te,"in-use"),c(re,"in-use");break;case"not-found":null!=(r=e.error)&&r.missingMedia.includes("video")&&c(te,"not-found"),null!=(i=e.error)&&i.missingMedia.includes("audio")&&c(re,"not-found");break;case"permissions":null!=(a=e.error)&&a.blockedMedia.includes("video")&&c(te,"blocked"),null!=(o=e.error)&&o.blockedMedia.includes("audio")&&c(re,"blocked");break;case"constraints":"invalid"===(null==(u=e.error)?void 0:u.reason)?(c(te,"constraints-invalid"),c(re,"constraints-invalid")):"none-specified"===(null==(l=e.error)?void 0:l.reason)&&(c(te,"constraints-none-specified"),c(re,"constraints-none-specified"));break;case"undefined-mediadevices":c(te,"undefined-mediadevices"),c(re,"undefined-mediadevices");break;case"unknown":default:c(te,"unknown"),c(re,"unknown")}}))}}),[])),h("started-camera",r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(){n((function(e){var n=e.set;n(te,"granted"),n(re,"granted")})),u()}}),[u])),t.createElement(ne.Provider,{value:{refreshDevices:o}},i)},ce=r.atom({key:"daily-react-live-streaming",default:{errorMsg:void 0,isLiveStreaming:!1,layout:void 0}}),se=function(e){var n=e.children;return h("live-streaming-started",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(ce,{isLiveStreaming:!0,layout:null==e?void 0:e.layout})}}),[])),h("live-streaming-stopped",r.useRecoilCallback((function(e){var n=e.set;return function(){n(ce,(function(e){return c({},e,{isLiveStreaming:!1,layout:void 0})}))}}),[])),h("live-streaming-error",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(ce,(function(n){return c({},n,{errorMsg:e.errorMsg})}))}}),[])),h("left-meeting",r.useRecoilCallback((function(e){var n=e.reset;return function(){n(ce)}}),[])),t.createElement(t.Fragment,null,n)},de=r.atom({key:"daily-react-meeting-state",default:"new"}),fe=r.atom({key:"daily-react-meeting-error",default:null}),pe=r.atom({key:"daily-react-non-fatal-error",default:null}),ve=r.atom({key:"meeting-session-data",default:{data:void 0,topology:"none"}}),ge=function(e){var n=e.children,i=v(),a=r.useRecoilCallback((function(e){var n=e.set;return function(){if(i){var e=i.meetingState();return n(de,e),e}}}),[i]);h("loading",a),h("loaded",a),h("joining-meeting",a),h("joined-meeting",a),h("left-meeting",a),h("error",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(fe,e),a()}}),[a])),h("nonfatal-error",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(pe,e)}}),[]));var o=r.useRecoilCallback((function(e){var n=e.set;return function(){i&&n(ve,i.meetingSessionState())}}),[i]);return h("joined-meeting",o),h("meeting-session-state-updated",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(ve,e.meetingSessionState)}}),[])),h("left-meeting",r.useRecoilCallback((function(e){var n=e.reset;return function(){n(ve)}}),[])),h("call-instance-destroyed",r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(){n((function(e){var n=e.reset;n(de),n(fe),n(pe),n(ve)}))}}),[])),t.createElement(t.Fragment,null,n)},ye=r.atom({key:"daily-react-topology",default:"none"}),me=r.atom({key:"daily-react-networkQuality",default:100}),be=r.atom({key:"daily-react-networkThreshold",default:"good"}),ke=function(e){var i=e.children,a=v(),o=r.useRecoilValue(ye),u=r.useRecoilCallback((function(e){var n=e.set;return l((function*(){if(a){var e=yield a.getNetworkTopology();e&&"none"!==(null==e?void 0:e.topology)&&n(ye,e.topology)}}))}),[a]);return h("joined-meeting",u),h("network-connection",r.useRecoilCallback((function(e){var n=e.set;return function(e){switch(e.event){case"connected":"peer-to-peer"===e.type&&n(ye,"peer"),"sfu"===e.type&&n(ye,"sfu")}}}),[])),h("network-quality-change",r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(e){n((function(n){var t=n.set;t(me,(function(n){return n!==e.quality?e.quality:n})),t(be,(function(n){return n!==e.threshold?e.threshold:n}))}))}}),[])),h("left-meeting",r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(){n((function(e){var n=e.reset;n(ye),n(me),n(be)}))}}),[])),n.useEffect((function(){a&&"none"===o&&u()}),[a,u,o]),t.createElement(t.Fragment,null,i)},he=r.atom({key:"daily-react-recording",default:{isLocalParticipantRecorded:!1,isRecording:!1}}),Se=function(e){var i=e.children,a=r.useSetRecoilState(he),o=q(),u=G({filter:"record"});return n.useEffect((function(){var e=u.length>0,n=u.includes(o||"local");a((function(t){return c({},t,{isLocalParticipantRecorded:"local"!==(null==t?void 0:t.type)&&null!=t&&t.type?t.isLocalParticipantRecorded:e,isRecording:"local"!==(null==t?void 0:t.type)&&null!=t&&t.type?t.isRecording:e,local:"local"!==(null==t?void 0:t.type)&&null!=t&&t.type||!e?null==t?void 0:t.local:n,type:e?"local":null==t?void 0:t.type})}))}),[o,u,a]),h("recording-started",r.useRecoilCallback((function(e){var n=e.set;return function(e){var t=!0;switch(e.type){case"cloud-beta":case"cloud":var r;o&&"single-participant"===(null==(r=e.layout)?void 0:r.preset)&&e.layout.session_id!==o&&(t=!1)}n(he,{error:!1,isLocalParticipantRecorded:t,isRecording:!0,layout:null==e?void 0:e.layout,local:null==e?void 0:e.local,recordingId:null==e?void 0:e.recordingId,recordingStartedDate:new Date,startedBy:null==e?void 0:e.startedBy,type:null==e?void 0:e.type})}}),[o])),h("recording-stopped",r.useRecoilCallback((function(e){var n=e.set;return function(){n(he,(function(e){return c({},e,{isLocalParticipantRecorded:!1,isRecording:!1})}))}}),[])),h("recording-error",r.useRecoilCallback((function(e){var n=e.set;return function(){n(he,(function(e){return c({},e,{error:!0,isLocalParticipantRecorded:!1,isRecording:!1})}))}}),[])),h("left-meeting",r.useRecoilCallback((function(e){var n=e.reset;return function(){n(he)}}),[])),t.createElement(t.Fragment,null,i)},Ce=function(){var e=r.useRecoilValue(de);return n.useDebugValue(e),e},Re=r.atom({key:"daily-react-room",default:null}),Ae=function(e){var n=e.children,i=v(),a=Ce(),o=r.useRecoilCallback((function(e){var n=e.set;return l((function*(){if(i&&"left-meeting"!==a){var e=yield i.room();return e&&"id"in e&&n(Re,e),e}}))}),[i,a]);return h("access-state-updated",o),h("left-meeting",r.useRecoilCallback((function(e){var n=e.reset;return function(){n(Re)}}),[])),t.createElement(t.Fragment,null,n)},Ee=r.atom({key:"daily-react-transcription",default:{isTranscribing:!1,model:"general",language:"en",transcriptions:[]}}),De=function(e){var n=e.children;return h("transcription-started",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(Ee,c({error:!1,isTranscribing:!0,transcriptionStartDate:new Date,transcriptions:[]},e))}}),[])),h("transcription-stopped",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(Ee,(function(n){return c({},n,{updatedBy:null==e?void 0:e.updatedBy,isTranscribing:!1})}))}}),[])),h("transcription-error",r.useRecoilCallback((function(e){var n=e.set;return function(){n(Ee,(function(e){return c({},e,{error:!0,isTranscribing:!1})}))}}),[])),h("left-meeting",r.useRecoilCallback((function(e){var n=e.set;return function(){n(Ee,(function(e){return c({},e,{isTranscribing:!1})}))}}),[])),h("app-message",r.useRecoilCallback((function(e){var n=e.set;return function(e){"transcription"===(null==e?void 0:e.fromId)&&n(Ee,(function(n){return c({},n,{isTranscribing:!0,transcriptions:[].concat(n.transcriptions,[e.data])})}))}}),[])),t.createElement(t.Fragment,null,n)},we={},xe=function(){return!0},Le={options:we,shouldCreateInstance:xe},_e=function(e,t){var r=void 0===t?Le:t,i=r.parentElRef,o=r.options,u=void 0===o?we:o,s=r.shouldCreateInstance,d=void 0===s?xe:s,f=n.useState(null),p=f[0],v=f[1],g=n.useRef();return n.useEffect((function(){if(("callFrame"!==e||null!==(null==i?void 0:i.current))&&d()){var n=function(){setTimeout((function(){return v(null)}),0)},t=a.getCallInstance();if(!p&&t&&!t.isDestroyed())return t.once("call-instance-destroyed",n),void v(t);if(p)D(g.current,u)||function(e){r.apply(this,arguments)}(p);else{if(!t||t.isDestroyed()){switch(e){case"callFrame":t=null!=i&&i.current?a.createFrame(i.current,c({},u)):a.createFrame(c({},u));break;case"callObject":t=a.createCallObject(c({},u))}g.current=u}v(t),t.once("call-instance-destroyed",n)}}function r(){return(r=l((function*(e){yield e.destroy()}))).apply(this,arguments)}}),[p,u,i,d,e]),p},Ve=function(e){return _e("callObject",e)},Ie=["children","recoilRootProps"],Te=function(e,t){var i=void 0===t?{}:t,a=i.onParticipantLeft,o=i.onParticipantUpdated,u=r.useRecoilValue(j(e));return E(["participant-updated","participant-left"],n.useCallback((function(n){var t=n.filter((function(n){return n.participant.session_id===e}));t.length&&t.forEach((function(e){switch(e.action){case"participant-updated":null==o||o(e);break;case"participant-left":null==a||a(e)}}))}),[a,o,e])),n.useDebugValue(u),u},Pe="data:application/javascript;charset=utf8,"+encodeURIComponent("\n    class AudioLevelProcessor extends AudioWorkletProcessor {\n    volume;\n    interval;\n    nextFrame;\n    \n    constructor() {\n      super();\n      this.volume = 0;\n      this.interval = 25;\n      this.nextFrame = this.interval;\n    }\n    \n    get intervalInFrames() {\n      // sampleRate is globally defined in AudioWorklets.\n      // See https://developer.mozilla.org/en-US/docs/Web/API/AudioWorkletGlobalScope\n      // eslint-disable-next-line no-undef\n      return (this.interval / 1000) * sampleRate;\n    }\n    \n    process(inputList) {\n      const firstInput = inputList[0];\n    \n      if (firstInput.length > 0) {\n        const inputData = firstInput[0];\n        let total = 0;\n    \n        for (let i = 0; i < inputData.length; ++i) {\n          total += Math.abs(inputData[i]);\n        }\n    \n        const rms = Math.sqrt(total / inputData.length);\n        this.volume = Math.max(0, Math.min(1, rms));\n    \n        this.nextFrame -= inputData.length;\n        if (this.nextFrame < 0) {\n          this.nextFrame += this.intervalInFrames;\n          this.port.postMessage({ volume: this.volume });\n        }\n      }\n    \n      return true;\n    }\n    }\n    \n    registerProcessor('audiolevel', AudioLevelProcessor);              \n"),je=r.atom({key:"cpu-load-state",default:{state:"low",reason:"none"}}),Me=function(){var e={meetingError:r.useRecoilValue(fe),nonFatalError:r.useRecoilValue(pe)};return n.useDebugValue(e),e},Oe=r.atom({key:"daily-react-input-settings",default:null}),Fe=r.atom({key:"daily-react-participant-counts",default:{hidden:0,present:0}}),Be=r.atomFamily({key:"daily-react-participant-receive-settings",default:{}}),qe=function(){var e=r.useRecoilValue(Re);return n.useDebugValue(e),e},Ue=r.atom({key:"daily-react-send-settings",default:null});exports.DailyAudio=Y,exports.DailyAudioTrack=X,exports.DailyProvider=function(e){var i=e.children,a=e.recoilRootProps,o=void 0===a?{}:a,u=s(e,Ie),l=n.useRef({}),c=n.useCallback((function(e){var n,t;if("action"in e)for(var r,i=Array.from(null!=(n=null==(t=l.current)?void 0:t[e.action])?n:[]),a=i.filter((function(e){return e[0]<0})),o=i.filter((function(e){return e[0]>0})),u=f([].concat(a,o));!(r=u()).done;)(0,r.value[1])(e)}),[]),d=n.useCallback((function(e){e&&Object.keys(l.current).forEach((function(n){e.off(n,c),e.isDestroyed()||e.on(n,c)}))}),[c]),v="callObject"in u?u.callObject:null,y=n.useMemo((function(){return"callObject"in u?{}:u}),[u]),m=Ve({options:y,shouldCreateInstance:n.useCallback((function(){return!("callObject"in u)}),[u])}),b=null!=v?v:m;n.useEffect((function(){b&&d(b)}),[b,d]);var k=n.useCallback((function(e,n,t){var r,i;l.current[e]||(l.current[e]=new Map,b&&(b.off(e,c),b.isDestroyed()||b.on(e,c))),null!=(r=l.current[e])&&r.has(t)||null==(i=l.current[e])||i.set(t,n)}),[b,c]),h=n.useCallback((function(e,n){var t,r;null==(t=l.current[e])||t.delete(n),0===(null==(r=l.current[e])?void 0:r.size)&&(null==b||b.off(e,c),delete l.current[e])}),[b,c]);return t.createElement(r.RecoilRoot,Object.assign({},o),t.createElement(p.Provider,{value:b},t.createElement(g.Provider,{value:{on:k,off:h}},t.createElement(Ae,null,t.createElement(ge,null,t.createElement(ke,null,t.createElement(B,null,t.createElement(Se,null,t.createElement(se,null,t.createElement(De,null,t.createElement(le,null,i)))))))))))},exports.DailyVideo=ee,exports.useActiveParticipant=function(e){var t=void 0===e?{}:e,i=t.ignoreLocal,a=void 0!==i&&i,o=t.onActiveSpeakerChange,u=v(),l=r.useRecoilValue(V),c=n.useState(""),s=c[1],d=Te(c[0]);return n.useEffect((function(){var e;if(u){var n=null==u||null==(e=u.participants())?void 0:e.local;a&&l===(null==n?void 0:n.session_id)||s(null!=l?l:"")}}),[u,a,l]),h("active-speaker-change",n.useCallback((function(e){null==o||o(e)}),[o])),n.useDebugValue(d),d},exports.useActiveSpeakerId=N,exports.useAppMessage=function(e){var t=(void 0===e?{}:e).onAppMessage,r=v(),i=n.useCallback((function(e,n){void 0===n&&(n="*"),r&&r.sendAppMessage(e,n)}),[r]),a=n.useCallback((function(e){null==t||t(e,i)}),[t,i]);return h("app-message",a),i},exports.useAudioLevel=function(e,t){var r=n.useRef();n.useEffect((function(){if(e){var n="undefined"!=typeof AudioContext?AudioContext:void 0!==window.webkitAudioContext?window.webkitAudioContext:null;if(n){r.current||(r.current=new n);var i=r.current;if(i){var a,o,u=i.createMediaStreamSource(new MediaStream([e]));return function(){var e=l((function*(){try{a=new AudioWorkletNode(i,"audiolevel"),o=i.createGain()}catch(e){try{yield i.audioWorklet.addModule(Pe),a=new AudioWorkletNode(i,"audiolevel"),o=i.createGain()}catch(e){console.error(e)}}if(a&&o){a.port.onmessage=function(e){var n=0;e.data.volume&&(n=e.data.volume),a&&t(n)},o.gain.value=0;try{u.connect(a).connect(o).connect(i.destination)}catch(e){console.warn(e)}}}));return function(){return e.apply(this,arguments)}}()(),function(){var e;null==(e=a)||e.disconnect(),a=null,null==u||u.disconnect()}}}}}),[t,e])},exports.useAudioLevelObserver=function(e,t){var r=v(),i=q(),a=e===i;h("local-audio-level",n.useCallback((function(e){a&&t(e.audioLevel)}),[t,a])),h("remote-participants-audio-level",n.useCallback((function(n){a||t(n.participantsAudioLevel[e])}),[t,e,a])),n.useEffect((function(){r&&!r.isDestroyed()&&a&&(r.isLocalAudioLevelObserverRunning()||r.startLocalAudioLevelObserver())}),[r,a]),n.useEffect((function(){!r||r.isDestroyed()||a||r.isRemoteParticipantsAudioLevelObserverRunning()||r.startRemoteParticipantsAudioLevelObserver()}),[r,a])},exports.useAudioTrack=function(e){return J(e,"audio")},exports.useCPULoad=function(e){var t=(void 0===e?{}:e).onCPULoadChange,i=r.useRecoilValue(je),a=v(),u=Ce(),c=r.useRecoilCallback((function(e){var n=e.set,t=e.snapshot;return function(){var e=l((function*(e){var r=yield t.getPromise(je);o(r,e)||n(je,e)}));return function(n){return e.apply(this,arguments)}}()}),[]);return n.useEffect((function(){var e=!0;if(a&&!a.isDestroyed()&&"joined-meeting"===u)return a.getCpuLoadStats().then((function(n){e&&c({state:n.cpuLoadState,reason:n.cpuLoadStateReason})})),function(){e=!1}}),[a,u,c]),h("cpu-load-change",n.useCallback((function(e){c({state:e.cpuLoadState,reason:e.cpuLoadStateReason}),null==t||t(e)}),[t,c])),n.useDebugValue(i),i},exports.useCallFrame=function(e){return _e("callFrame",e)},exports.useCallObject=Ve,exports.useDaily=v,exports.useDailyError=Me,exports.useDailyEvent=h,exports.useDevices=function(){var e=v(),t=r.useRecoilValue(te),i=r.useRecoilValue(re),a=r.useRecoilValue(ie),o=r.useRecoilValue(ae),u=r.useRecoilValue(oe),c=r.useRecoilValue(ue),s=n.useContext(ne).refreshDevices,d=n.useCallback(function(){var n=l((function*(n){yield null==e?void 0:e.setInputDevicesAsync({audioDeviceId:null,videoDeviceId:n})}));return function(e){return n.apply(this,arguments)}}(),[e]),f=n.useCallback(function(){var n=l((function*(n){yield null==e?void 0:e.setInputDevicesAsync({audioDeviceId:n,videoDeviceId:null})}));return function(e){return n.apply(this,arguments)}}(),[e]),p=n.useCallback(function(){var n=l((function*(n){yield null==e?void 0:e.setOutputDeviceAsync({outputDeviceId:n})}));return function(e){return n.apply(this,arguments)}}(),[e]),g=["blocked","in-use","not-found","constraints-invalid","constraints-none-specified","undefined-mediadevices","unknown"],y={cameraError:c,cameras:a,camState:t,currentCam:a.find((function(e){return e.selected})),currentMic:o.find((function(e){return e.selected})),currentSpeaker:u.find((function(e){return e.selected})),hasCamError:g.includes(t),hasMicError:g.includes(i),microphones:o,micState:i,refreshDevices:s,setCamera:d,setMicrophone:f,setSpeaker:p,speakers:u};return n.useDebugValue(y),y},exports.useInputSettings=function(e){var t=void 0===e?{}:e,i=t.onError,a=t.onInputSettingsUpdated,o=r.useRecoilValue(Oe),u=Me().nonFatalError,l=v(),c=r.useRecoilCallback((function(e){var n=e.set;return function(e){n(Oe,e)}}),[]);n.useEffect((function(){l&&l.getInputSettings().then(c)}),[l,c]),h("input-settings-updated",n.useCallback((function(e){c(e.inputSettings),null==a||a(e)}),[a,c])),h("nonfatal-error",n.useCallback((function(e){"input-settings-error"===e.type&&(null==i||i(e))}),[i]));var s=n.useCallback((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return null==l?void 0:l.updateInputSettings.apply(l,n)}),[l]),d={errorMsg:"input-settings-error"===(null==u?void 0:u.type)?u.errorMsg:null,inputSettings:o,updateInputSettings:s};return n.useDebugValue(d),d},exports.useLiveStreaming=function(e){var t=void 0===e?{}:e,i=t.onLiveStreamingError,a=t.onLiveStreamingStarted,o=t.onLiveStreamingStopped,u=t.onLiveStreamingUpdated,l=t.onLiveStreamingWarning,s=v(),d=r.useRecoilValue(ce);h("live-streaming-started",n.useCallback((function(e){null==a||a(e)}),[a])),h("live-streaming-stopped",n.useCallback((function(e){null==o||o(e)}),[o])),h("live-streaming-updated",n.useCallback((function(e){null==u||u(e)}),[u])),h("live-streaming-error",n.useCallback((function(e){null==i||i(e)}),[i])),h("nonfatal-error",n.useCallback((function(e){"live-streaming-warning"===e.type&&(null==l||l(e))}),[l]));var f=c({},d,{startLiveStreaming:n.useCallback((function(){s&&s.startLiveStreaming.apply(s,arguments)}),[s]),stopLiveStreaming:n.useCallback((function(){s&&s.stopLiveStreaming.apply(s,arguments)}),[s]),updateLiveStreaming:n.useCallback((function(){s&&s.updateLiveStreaming.apply(s,arguments)}),[s])});return n.useDebugValue(f),f},exports.useLocalParticipant=function(){var e=r.useRecoilValue(I),t=Te(e);return n.useDebugValue(t),t},exports.useLocalSessionId=q,exports.useMediaTrack=J,exports.useMeetingSessionState=function(e){var t=(void 0===e?{}:e).onError,i=r.useRecoilValue(ve);h("nonfatal-error",n.useCallback((function(e){"meeting-session-data-error"===e.type&&(null==t||t(e))}),[t]));var a={data:null==i?void 0:i.data,topology:null==i?void 0:i.topology};return n.useDebugValue(a),a},exports.useMeetingState=Ce,exports.useNetwork=function(e){var t=void 0===e?{}:e,i=t.onNetworkConnection,a=t.onNetworkQualityChange,o=v(),u=r.useRecoilValue(ye),c=r.useRecoilValue(me),s=r.useRecoilValue(be);h("network-connection",n.useCallback((function(e){null==i||i(e)}),[i])),h("network-quality-change",n.useCallback((function(e){null==a||a(e)}),[a]));var d={getStats:n.useCallback(l((function*(){var e=yield null==o?void 0:o.getNetworkStats();return null==e?void 0:e.stats})),[o]),quality:c,threshold:s,topology:u};return n.useDebugValue(d),d},exports.useParticipant=Te,exports.useParticipantCounts=function(e){var t=(void 0===e?{}:e).onParticipantCountsUpdated,i=v(),a=r.useRecoilValue(Fe),o=r.useRecoilCallback((function(e){var n=e.set;return function(e){n(Fe,e)}}),[]);return h("participant-counts-updated",n.useCallback((function(e){o(e.participantCounts),null==t||t(e)}),[t,o])),n.useEffect((function(){i&&!i.isDestroyed()&&o(i.participantCounts())}),[i,o]),n.useDebugValue(a),a},exports.useParticipantIds=G,exports.useParticipantProperty=A,exports.usePermissions=function(e){var t,r,i,a,o,u,l,c,s,d=q(),f=A(null!=e?e:d,"permissions"),p="boolean"==typeof(null==f?void 0:f.canSend)?null==f?void 0:f.canSend:Boolean(null==f||null==(t=f.canSend)?void 0:t.has("audio")),v="boolean"==typeof(null==f?void 0:f.canSend)?null==f?void 0:f.canSend:Boolean(null==f||null==(r=f.canSend)?void 0:r.has("video")),g="boolean"==typeof(null==f?void 0:f.canSend)?null==f?void 0:f.canSend:Boolean(null==f||null==(i=f.canSend)?void 0:i.has("customAudio")),y="boolean"==typeof(null==f?void 0:f.canSend)?null==f?void 0:f.canSend:Boolean(null==f||null==(a=f.canSend)?void 0:a.has("customVideo")),m="boolean"==typeof(null==f?void 0:f.canSend)?null==f?void 0:f.canSend:Boolean(null==f||null==(o=f.canSend)?void 0:o.has("screenAudio")),b="boolean"==typeof(null==f?void 0:f.canSend)?null==f?void 0:f.canSend:Boolean(null==f||null==(u=f.canSend)?void 0:u.has("screenVideo")),k={canAdminParticipants:"boolean"==typeof(null==f?void 0:f.canAdmin)?null==f?void 0:f.canAdmin:Boolean(null==f||null==(l=f.canAdmin)?void 0:l.has("participants")),canAdminStreaming:"boolean"==typeof(null==f?void 0:f.canAdmin)?null==f?void 0:f.canAdmin:Boolean(null==f||null==(c=f.canAdmin)?void 0:c.has("streaming")),canAdminTranscription:"boolean"==typeof(null==f?void 0:f.canAdmin)?null==f?void 0:f.canAdmin:Boolean(null==f||null==(s=f.canAdmin)?void 0:s.has("transcription")),canSendAudio:p,canSendCustomAudio:g,canSendCustomVideo:y,canSendScreenAudio:m,canSendScreenVideo:b,canSendVideo:v,hasPresence:null==f?void 0:f.hasPresence,permissions:f};return n.useDebugValue(k),k},exports.useReceiveSettings=function(e){var t=void 0===e?{}:e,i=t.id,a=void 0===i?"base":i,o=t.onReceiveSettingsUpdated,u=r.useRecoilValue(Be("base")),l=r.useRecoilValue(Be(a)),s=v(),d=Ce(),f=r.useRecoilCallback((function(e){var n=e.transact_UNSTABLE;return function(e){n((function(n){for(var t=n.reset,r=n.set,i=c({},e),o=0,u=Object.entries(i);o<u.length;o++){var l=u[o],s=l[1];r(Be(l[0]),s)}a in i||t(Be(a))}))}}),[a]);h("receive-settings-updated",n.useCallback((function(e){f(e.receiveSettings),null==o||o(e)}),[o,f])),n.useEffect((function(){s&&!s.isDestroyed()&&s.getReceiveSettings().then(f)}),[s,f]);var p=n.useCallback((function(){if(s&&"joined-meeting"===d){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];null==s||null==s.updateReceiveSettings||s.updateReceiveSettings.apply(s,n)}}),[s,d]),g={receiveSettings:"base"===a||0===Object.keys(l).length?u:l,updateReceiveSettings:p};return n.useDebugValue(g),g},exports.useRecording=function(e){var t=void 0===e?{}:e,i=t.onRecordingData,a=t.onRecordingError,o=t.onRecordingStarted,u=t.onRecordingStopped,l=v(),s=r.useRecoilValue(he);h("recording-started",n.useCallback((function(e){null==o||o(e)}),[o])),h("recording-stopped",n.useCallback((function(e){null==u||u(e)}),[u])),h("recording-error",n.useCallback((function(e){null==a||a(e)}),[a])),h("recording-data",n.useCallback((function(e){null==i||i(e)}),[i]));var d=c({},s,{startRecording:n.useCallback((function(){l&&l.startRecording.apply(l,arguments)}),[l]),stopRecording:n.useCallback((function(){l&&l.stopRecording.apply(l,arguments)}),[l]),updateRecording:n.useCallback((function(){l&&l.updateRecording.apply(l,arguments)}),[l])});return n.useDebugValue(d),d},exports.useRoom=qe,exports.useRoomExp=function(e){var t,i,a,o,u,l,c=(void 0===e?{}:e).onCountdown,s=r.useRecoilValue(T),d=qe(),f=n.useState(null),p=f[0],v=f[1];n.useEffect((function(){var e,n,t,r,i,a,o,u,l,c,f,p,g=null!=(e=null!=(n=null==d||null==(t=d.tokenConfig)?void 0:t.eject_after_elapsed)?n:null==d||null==(r=d.config)?void 0:r.eject_after_elapsed)?e:0,y=null!=(i=null!=(a=null==d||null==(o=d.tokenConfig)?void 0:o.exp)?a:null==d||null==(u=d.config)?void 0:u.exp)?i:0,m=null!=(l=null!=(c=null==d||null==(f=d.tokenConfig)?void 0:f.eject_at_token_exp)?c:null==d||null==(p=d.config)?void 0:p.eject_at_room_exp)&&l,b=new Date(0);if(g&&s&&(b=new Date(s.getTime()+1e3*g)),m&&y){var k=new Date(1e3*y);(!b.getTime()||b.getTime()>0&&k<b)&&(b=k)}0!==b.getTime()&&v((function(e){return(null==e?void 0:e.getTime())!==b.getTime()?b:e}))}),[s,null==d||null==(t=d.config)?void 0:t.eject_after_elapsed,null==d||null==(i=d.config)?void 0:i.eject_at_room_exp,null==d||null==(a=d.config)?void 0:a.exp,null==d||null==(o=d.tokenConfig)?void 0:o.eject_after_elapsed,null==d||null==(u=d.tokenConfig)?void 0:u.eject_at_token_exp,null==d||null==(l=d.tokenConfig)?void 0:l.exp]),n.useEffect((function(){if(p&&0!==p.getTime()){var e=setInterval((function(){var e,n=(null!=(e=null==p?void 0:p.getTime())?e:0)/1e3-Date.now()/1e3;if(!(n<0)){var t=Math.max(0,Math.floor(n/3600)),r=Math.max(0,Math.floor(n%3600/60)),i=Math.max(0,Math.floor(n%60));null==c||c({hours:t,minutes:r,seconds:i})}}),1e3);return function(){clearInterval(e)}}}),[p,c]);var g={ejectDate:p};return n.useDebugValue(g),g},exports.useScreenAudioTrack=function(e){return J(e,"screenAudio")},exports.useScreenShare=Q,exports.useScreenVideoTrack=function(e){return J(e,"screenVideo")},exports.useSendSettings=function(e){var t=(void 0===e?{}:e).onSendSettingsUpdated,i=v(),a=r.useRecoilValue(Ue);h("send-settings-updated",r.useRecoilCallback((function(e){var n=e.set;return function(e){n(Ue,e.sendSettings),null==t||t(e)}}),[t]));var o=r.useRecoilCallback((function(e){var n=e.set;return function(e){n(Ue,e)}}),[]);n.useEffect((function(){i&&!i.isDestroyed()&&o(i.getSendSettings())}),[i,o]);var u={sendSettings:a,updateSendSettings:n.useCallback(l((function*(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=yield null==i?void 0:i.updateSendSettings.apply(i,n);if(r)return o(r),r})),[i,o])};return n.useDebugValue(u),u},exports.useThrottledDailyEvent=E,exports.useTranscription=function(e){var t=void 0===e?{}:e,i=t.onTranscriptionAppData,a=t.onTranscriptionError,o=t.onTranscriptionMessage,u=t.onTranscriptionStarted,l=t.onTranscriptionStopped,s=v(),d=r.useRecoilValue(Ee);h("transcription-started",n.useCallback((function(e){null==u||u(e)}),[u])),h("transcription-stopped",n.useCallback((function(e){null==l||l(e)}),[l])),h("transcription-error",n.useCallback((function(e){null==a||a(e)}),[a])),h("transcription-message",n.useCallback((function(e){null==o||o(e)}),[o])),h("app-message",n.useCallback((function(e){"transcription"===(null==e?void 0:e.fromId)&&(null==i||i(e))}),[i]));var f=c({},d,{startTranscription:n.useCallback((function(){s&&s.startTranscription.apply(s,arguments)}),[s]),stopTranscription:n.useCallback((function(){s&&s.stopTranscription.apply(s,arguments)}),[s])});return n.useDebugValue(f),f},exports.useVideoTrack=function(e){return J(e,"video")},exports.useWaitingParticipants=function(e){var t=void 0===e?{}:e,i=t.onWaitingParticipantAdded,a=t.onWaitingParticipantRemoved,o=t.onWaitingParticipantUpdated,u=v(),l=r.useRecoilValue(F);h("waiting-participant-added",n.useCallback((function(e){null==i||i(e)}),[i])),h("waiting-participant-removed",n.useCallback((function(e){null==a||a(e)}),[a])),h("waiting-participant-updated",n.useCallback((function(e){null==o||o(e)}),[o]));var c=n.useCallback((function(e,n){"*"!==e?null==u||u.updateWaitingParticipant(e,{grantRequestedAccess:n}):null==u||u.updateWaitingParticipants({"*":{grantRequestedAccess:n}})}),[u]),s={waitingParticipants:l,grantAccess:n.useCallback((function(e){c(e,!0)}),[c]),denyAccess:n.useCallback((function(e){c(e,!1)}),[c])};return n.useDebugValue(s),s};
//# sourceMappingURL=daily-react.cjs.production.min.js.map
